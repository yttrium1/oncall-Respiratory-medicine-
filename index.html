<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Calendar Page with Email Sending</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-lg mx-auto py-10 relative">
        <div class="absolute top-0 right-0 text-xs text-gray-600 p-4">呼内オンコール</div>
        <div class="text-center mb-8">
            <div class="mb-4">
                <span class="inline-block bg-green-200 text-green-800 text-sm font-semibold px-4 py-1 rounded-full">STEP 1</span>
            </div>
            <p class="font-semibold">回答者の名前を入力してください</p>
            <input id="responderName" type="text" placeholder="例）山田太郎" class="mt-4 bg-white text-sm py-2 px-6 rounded-full focus:outline-none border border-gray-300 w-full">
        </div>
        <div class="text-center mb-8">
            <div class="mb-4">
                <span class="inline-block bg-green-200 text-green-800 text-sm font-semibold px-4 py-1 rounded-full">STEP 2</span>
            </div>
            <p class="font-semibold">特に希望する日を選択してください</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow" id="calendar">
            <div class="flex items-center justify-between mb-4">
                <button class="text-gray-600 focus:outline-none" onclick="changeMonth(-1, 'preferred')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="font-semibold" id="preferredMonthYear"></div>
                <button class="text-gray-600 focus:outline-none" onclick="changeMonth(1, 'preferred')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-4 text-sm" id="preferredDays">
                <!-- Calendar days will be generated by JavaScript -->
            </div>
        </div>
        <div class="text-center mt-8">
            <div class="mb-4">
                <span class="inline-block bg-green-200 text-green-800 text-sm font-semibold px-4 py-1 rounded-full">STEP 3</span>
            </div>
            <p class="font-semibold">特に希望しない日を選択してください</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow mb-8" id="calendar">
            <div class="flex items-center justify-between mb-4">
                <button class="text-gray-600 focus:outline-none" onclick="changeMonth(-1, 'notPreferred')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="font-semibold" id="notPreferredMonthYear"></div>
                <button class="text-gray-600 focus:outline-none" onclick="changeMonth(1, 'notPreferred')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="grid grid-cols-7 gap-4 text-sm" id="notPreferredDays">
                <!-- Calendar days will be generated by JavaScript -->
            </div>
        </div>
        <div class="text-center mt-8">
            <div class="mb-4">
                <span class="inline-block bg-yellow-200 text-yellow-800 text-sm font-semibold px-4 py-1 rounded-full">STEP 4</span>
            </div>
            <button onclick="generateLink()" class="bg-yellow-500 text-white text-sm py-2 px-6 rounded-full focus:outline-none">URLを発行する</button>
        </div>
    </div>

    <script>
        const monthNames = ["1月", "2月", "3月", "4月", "5月", "6月", "7月", "8月", "9月", "10月", "11月", "12月"];
        const dayNames = ["日", "月", "火", "水", "木", "金", "土"];
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let preferredDays = new Set();
        let notPreferredDays = new Set();

        function generateCalendar(month, year, type) {
            const firstDay = new Date(year, month).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const calendarDays = document.getElementById(`${type}Days`);
            calendarDays.innerHTML = dayNames.map(day => `<div class="text-center ${day === '日' ? 'text-red-500' : ''}">${day}</div>`).join('') + new Array(firstDay).fill('<div class="col-span-1"></div>').join('');

            for (let i = 1; i <= daysInMonth; i++) {
                const isSelected = (type === 'preferred' ? preferredDays : notPreferredDays).has(`${year}-${month}-${i}`);
                const selectionColor = type === 'preferred' ? 'bg-green-500' : 'bg-red-500';
                calendarDays.innerHTML += `<div class="col-span-1 text-center cursor-pointer ${isSelected ? `${selectionColor} text-white` : ''}" onclick="selectDate(${i}, '${type}')">${i}</div>`;
            }

            document.getElementById(`${type}MonthYear`).textContent = `${year}年 ${monthNames[month]}`;
        }

        function changeMonth(step, type) {
            currentMonth += step;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar(currentMonth, currentYear, type);
        }

        function selectDate(day, type) {
            const dateKey = `${currentYear}-${currentMonth}-${day}`;
            const daysSet = (type === 'preferred' ? preferredDays : notPreferredDays);
            if (daysSet.has(dateKey)) {
                daysSet.delete(dateKey);
            } else {
                daysSet.add(dateKey);
            }
            generateCalendar(currentMonth, currentYear, type);
        }

        function generateLink() {
            const responderName = document.getElementById('responderName').value;
            const preferredDates = Array.from(preferredDays).join(',');
            const notPreferredDates = Array.from(notPreferredDays).join(',');
            const encodedData = encodeURIComponent(`Responder Name: ${responderName}, Preferred Dates: ${preferredDates}, Not Preferred Dates: ${notPreferredDates}`);
            const excelLink = `https://example.com/generate-excel?data=${encodedData}`;
            // Simulate generating and displaying the table
            const tableSummary = `Responder Name: ${responderName}\nPreferred Dates: ${preferredDates}\nNot Preferred Dates: ${notPreferredDates}`;
            alert(`Table Summary:\n${tableSummary}`);
            // Ask to save the result
            if (confirm('結果を保存しますか？')) {
                // Simulate saving the result
                alert('結果が保存されました。');
            }
            // Display the generated link
            alert(`Generated Link: ${excelLink}`);
            // Simulate sending the email
            sendEmail(excelLink);
        }

        function sendEmail(link) {
            // In a real-world scenario, you would make an AJAX call to your server to send the email.
            // Here, we'll just simulate this with an alert.
            alert(`The link has been sent to yttrium4649@yahoo.co.jp:\n${link}`);
        }

        generateCalendar(currentMonth, currentYear, 'preferred');
        generateCalendar(currentMonth, currentYear, 'notPreferred');
    </script>
</body>
</html>
